# ✅ Fixed: Portainer Volume Deletion Not Wiping Data

## The Problem

When you deleted the `blucatch` volume in Portainer, the data wasn't actually wiped. It came back on the next deploy.

## Root Cause

**Data files were committed to git:**
- `public/data/pokemon.db` (732KB) ✅ NOW REMOVED
- `public/data/games.json` (2.0MB) ✅ NOW REMOVED
- `public/data/pokemon.json` (179KB) ✅ NOW REMOVED
- `public/data/*.backup` files ✅ NOW REMOVED

### What Was Happening:

```
1. Delete volume in Portainer
   ✅ Data deleted from container

2. Portainer rebuilds container
   📦 Pulls latest code from GitHub
   ⚠️  Git repo includes pokemon.db and games.json!
   
3. Docker COPY command runs
   ❌ Data files copied from git repo into container
   
4. Data "magically" restored
   🤔 User confused why volume deletion didn't work
```

## The Fix

### Updated `.gitignore`:
```gitignore
# Data files (generated by scraper, should not be in git)
public/data/pokemon.db
public/data/pokemon.db-*
public/data/games.json
public/data/pokemon.json
public/data/*.backup*
```

### Removed from git:
```bash
git rm --cached public/data/pokemon.db
git rm --cached public/data/games.json
git rm --cached public/data/pokemon.json
git rm --cached public/data/*.backup
```

**Total removed**: ~3MB of data files

---

## How It Works Now

### ✅ Fresh Deploy Process:

```
1. Delete volume in Portainer
   ✅ Data truly wiped

2. Portainer pulls from GitHub
   ✅ No data files in repo anymore
   
3. Docker COPY runs
   ✅ Only copies code, scripts, schemas
   ❌ NO pokemon.db or games.json
   
4. docker-entrypoint.sh runs
   ✅ FORCE_FRESH=true wipes any data
   ✅ Creates empty pokemon.db with schema
   ✅ Runs scraper from scratch
   ✅ Generates fresh games.json
   
5. Result
   ✅ 100% fresh data on every deploy
```

---

## Testing This

### To verify data is truly wiped:

1. **Push these changes:**
   ```bash
   git push origin main
   ```

2. **In Portainer:**
   - Go to Volumes
   - Find `blucatch` volume (or whatever your data volume is named)
   - Click "Remove"
   - Confirm deletion

3. **Redeploy:**
   - Go to Stacks
   - Click your stack
   - Pull and redeploy

4. **Watch logs:**
   ```
   You should see:
   🗑️  FORCE_FRESH=true - Wiping existing data...
   📊 Creating fresh database with schema...
   🚀 Route-Based Scraper Started
   [1/151] Processing Bulbasaur...
   ```

5. **Verify fresh data:**
   - Check scraper logs for "Wiping existing data"
   - Check that encounter counts start from 0
   - Verify scraping progress from Pokemon #1

---

## What Files ARE in Git (Should Be)

✅ **Code**:
- `src/`, `scripts/`, `public/images/`
- `package.json`, `Dockerfile`, `docker-compose.yml`

✅ **Small config/reference files**:
- `public/data/evolution-map.json` (71KB)
- `public/data/evolution-relationships.json` (7.5KB)

❌ **NOT in Git** (generated by scraper):
- `public/data/pokemon.db` - SQLite database
- `public/data/games.json` - Game encounter data
- `public/data/pokemon.json` - Pokemon metadata
- `public/api/` - API endpoints
- Backup files

---

## Why This Matters

**Before**: Stale data could persist across deploys even with `FORCE_FRESH=true` because git restored the files.

**After**: Every deploy with deleted volume = truly fresh scrape with latest parser fixes.

This is especially important when you:
- Fix parser bugs (like the BDSP/Moltres issue)
- Update location filters (like spin-off filtering)
- Want to test from scratch

---

## Commit Summary

```
35a419b fix: Remove data files from git tracking
```

This commit:
- Removes 3MB of data files from git
- Updates .gitignore to prevent future commits
- Ensures volume deletion actually wipes data
- Allows clean testing of scraper improvements

---

## ✅ Ready to Push

The data removal is committed. When you push and redeploy:
- Volume deletion will truly wipe data
- Fresh scrape will generate clean data with all our fixes
- No more mystery data restoration

